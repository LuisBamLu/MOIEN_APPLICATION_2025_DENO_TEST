<script>
    // -- IMPORTS

    import { getLocalizedText } from 'senselogic-gist';
    import { languageTagStore } from '$store/languageTagStore';
    import AdminPage from '$component/element/AdminPage.svelte';
    import
    {
        handleCreateRentalReview,
        handleDeleteRentalReview,
        handleEditRentalReview,
        isRentalReviewModalOpen,
        loadRentalReviewArray,
        profileArrayStore,
        propertyArrayStore,
        rentalReviewArrayStore,
        selectedRentalReviewStore,
        toggleRentalReviewModal
    }
    from '$lib/store/rentalReviewStore';

    // -- CONSTANTS

    const filterParameterByKeyMap =
    {
        userName:
        {
            type: 'text',
            name: 'User',
            value: ''
        },
        propertyTitle:
        {
            type: 'text',
            name: 'Property',
            value: ''
        },
        rating:
        {
            type : 'number',
            name : 'Rating',
            value : 0
        },
        cleanlinessRating:
        {
            type: 'number',
            name: 'Cleanlinesss rating',
            value: 0
        },
        communicationRating:
        {
            type: 'number',
            name: 'Communication rating',
            value: 0
        },
        checkInRating:
        {
            type: 'number',
            name: 'Check in rating',
            value: 0
        },
        accuracyRating:
        {
            type: 'number',
            name: 'Accuracy rating',
            value: 0
        },
        locationRating:
        {
            type: 'number',
            name: 'Location rating',
            value: 0
        },
        valueRating:
        {
            type: 'number',
            name: 'Value rating',
            value: 0
        },
        text:
        {
            type: 'text',
            name: 'Text',
            value: ''
        },
        creationTimestamp:
        {
            type: 'date',
            name: 'Created at',
            value: new Date().toISOString()
        },
        updateTimestamp:
        {
            type: 'date',
            name: 'Updated at',
            value: new Date().toISOString()
        }
    };

    const titleSlugMap =
    {
        editTitle: 'edit-rental-review-label',
        addTitle: 'add-rental-review-label'
    };

    // -- FUNCTIONS

    function arrayProcessing(
        )
    {
        $rentalReviewArrayStore = $rentalReviewArrayStore?.map(
            ( rentalReview ) =>
            {
                let profile = $profileArrayStore.find( ( profile ) => profile.userId === rentalReview.userId );
                let property = $propertyArrayStore.find( ( property ) => property.id === rentalReview.propertyId );
                rentalReview.userName = profile ? `${ profile.firstName } ${ profile.lastName }` : 'Unknown';
                rentalReview.propertyTitle = property ? getLocalizedText( property.title, $languageTagStore ) : 'Unknown';
                rentalReview.profile = profile;
                rentalReview.property = property;

                return rentalReview;
            }
            );

        $rentalReviewArrayStore = $rentalReviewArrayStore?.sort(
            ( a, b ) => ( a.propertyId - b.propertyId || a.spaceId - b.spaceId )
            );
    }
</script>

<AdminPage
    pageTitle="admin-menu-rental-review-manager-label"
    selectedObject={ selectedRentalReviewStore }
    objectArrayStore={ rentalReviewArrayStore }
    isObjectModalOpen={ isRentalReviewModalOpen }
    filterParameterByKeyMap={ filterParameterByKeyMap }
    titleSlugMap={ titleSlugMap }
    loadObjectArray={ loadRentalReviewArray }
    arrayProcessing={ arrayProcessing }
    handleCreateObject={ handleCreateRentalReview }
    handleEditObject={ handleEditRentalReview }
    handleDeleteObject={ handleDeleteRentalReview }
    toggleObjectModal={ toggleRentalReviewModal }
/>
