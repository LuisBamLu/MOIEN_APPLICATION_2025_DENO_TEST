<script>
    // -- IMPORTS

    import { getFormattedPrice, getOptionArray } from '$lib/base';
    import { getLocalizedText } from 'senselogic-gist';
    import { languageTagStore } from '$store/languageTagStore';
    import AdminPage from '$component/element/AdminPage.svelte';
    import
    {
        handleCreateRentalAnnouncement,
        handleDeleteRentalAnnouncement,
        handleEditRentalAnnouncement,
        isRentalAnnouncementModalOpen,
        loadRentalAnnouncementArray,
        profileArrayStore,
        propertyArrayStore,
        rentalAnnouncementArrayStore,
        selectedRentalAnnouncementStore,
        toggleRentalAnnouncementModal
    }
    from '$store/rentalAnnouncementStore';

    // -- CONSTANTS

    const filterParameterByKeyMap =
    {
        userName :
        {
            type: 'text',
            name: 'User',
            value: ''
        },
        propertyTitle :
        {
            type: 'text',
            name: 'Property',
            value: ''
        },
        title:
        {
            type: 'text',
            name: 'Title',
            value: '',
        },
        description:
        {
            type: 'text',
            name: 'Description',
            value: ''
        },
        name:
        {
            type: 'text',
            name: 'Name',
            value: ''
        }
    };
    const titleSlugMap =
    {
        editTitle: 'edit-rental-announcement-label',
        addTitle: 'add-rental-announcement-label'
    };

    // -- VARIABLES

    let selectedRentalAnnouncementIndex = null;
    let searchTerm = '';
    let searchColumn = '';

    // -- FUNCTIONS

    function arrayProcessing(
        )
    {
        $rentalAnnouncementArrayStore = $rentalAnnouncementArrayStore?.map(
            ( rentalAnnouncement ) =>
            {
                let profile = $profileArrayStore.find( ( profile ) => profile.userId === rentalAnnouncement.userId );
                let property = $propertyArrayStore.find( ( property ) => property.id === rentalAnnouncement.propertyId );
                rentalAnnouncement.userName = profile ? `${ profile.firstName } ${ profile.lastName }` : 'Unknown';
                rentalAnnouncement.propertyTitle = property ? getLocalizedText( property.title, $languageTagStore ) : 'Unknown';
                rentalAnnouncement.title =
                    rentalAnnouncement.title
                    ? getLocalizedText( rentalAnnouncement.title, $languageTagStore )
                    : 'None';
                rentalAnnouncement.description =
                    rentalAnnouncement.description
                    ? getLocalizedText( rentalAnnouncement.description, $languageTagStore )
                    : 'None';
                rentalAnnouncement.name =
                    rentalAnnouncement.name
                    ? getLocalizedText( rentalAnnouncement.name, $languageTagStore )
                    : 'None';
                rentalAnnouncement.profile = profile;
                rentalAnnouncement.property = property;

                return rentalAnnouncement;
            }
            );

        $rentalAnnouncementArrayStore = $rentalAnnouncementArrayStore?.sort(
            ( a, b ) =>
            (
                a.propertyId - b.propertyId
                || a.spaceId - b.spaceId
            )
            );
    }
</script>

<AdminPage
    pageTitle="admin-menu-rental-announcements-label"
    selectedObject={ selectedRentalAnnouncementStore }
    objectArrayStore={ rentalAnnouncementArrayStore }
    isObjectModalOpen={ isRentalAnnouncementModalOpen }
    filterParameterByKeyMap={ filterParameterByKeyMap }
    titleSlugMap={ titleSlugMap }
    loadObjectArray={ loadRentalAnnouncementArray }
    arrayProcessing={ arrayProcessing }
    handleCreateObject={ handleCreateRentalAnnouncement }
    handleEditObject={ handleEditRentalAnnouncement }
    handleDeleteObject={ handleDeleteRentalAnnouncement }
    toggleObjectModal={ toggleRentalAnnouncementModal }
    showButton={ false }
/>
